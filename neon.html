<!DOCTYPE html>
<html lang="eng">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing on the Web</title>
    <script type="text/javascript" src="js/p5.js"></script>
    <script type="text/javascript" src="js/p5.min.js"></script>
    <script type="text/javascript" src="js/p5.dom.js"></script>
</head>

<body style="margin:0px">
    <div style="position:relative; display:block; margin-top:-670px;">
        <script>
        var video;
        var vScale = 10;
        function setup() { 
            createCanvas(windowWidth, windowHeight);
            pixelDensity(1);
            video = createCapture(VIDEO);
            video.size = (width/vScale, height/vScale);
            video.hide();
        }
        function draw() { 
            background(51);
            video.loadPixels();
            loadPixels();
            for (var y = 0; y < video.height; y++){
                for (var x = 0; x < video.width; x++){
                    var index = (video.width - x + 1 + (y * video.height))*4;
                    var r = video.pixels[index+0];
                    var g = video.pixels[index+1];
                    var b = video.pixels[index+2];
                    
                    var bright = (r+g+b)/3;
                    var w = map(bright, 0, 255, 0, vScale);
                    noStroke;
                    fill(random(255), random(255), random(255));
                    rectMode(CENTER);
                    rect(x*vScale, y*vScale, w, w);
                }
            }
        }
        </script>
    </div>
    

</body>
</html>